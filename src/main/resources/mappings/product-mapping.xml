<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mappings.product-mapping">
	<!-- 신상품 조회 -->
	<select id="getNewProductList" resultType="product">
		SELECT * FROM new_book_view
	</select>
	
	<!-- 베스트 상품 조회 -->
	<select id="getBestProductList" resultType="product">
		SELECT * FROM best_book_view
	</select>
	
	<!-- 무료 상품 조회 -->
	<select id="getFreeProductList" resultType="product">
		SELECT * FROM free_book_view
	</select>	
	
	<!-- 상품 상세 조회 -->
	<select id="getProduct" resultType="product">
		SELECT * FROM ebook WHERE bseq=#{bseq}
	</select>
	
	<!-- 카테고리별 상품 조회 -->
	<select id="getProductListByKind" resultType="product">
		SELECT * FROM ebook
		 WHERE category=#{category} 
		 ORDER BY title
	</select>
	
	<!-- 조회한 총 상품의 갯수 -->
	<select id="countProductList" parameterType="String" resultType="int">
		SELECT COUNT(*) FROM ebook
		 WHERE title LIKE '%'||#{title}||'%'
	</select>
	
	<!-- 상품 목록 조회 -->
	<select id="listProduct" parameterType="String" resultType="product">
		SELECT bseq, regdate, title, author, price, price_rent, useyn, likeyn
		  FROM ebook
		 WHERE title LIKE '%'||#{title}||'%'
		 ORDER BY bseq DESC 
	</select>
	
	<!-- 페이지별 상품목록 조회 -->
	<select id="listWithPaging" parameterType="hashMap" resultType="product">
	<![CDATA[
	SELECT bseq, regdate, title, author, price, price_rent, useyn, likeyn
      FROM  (SELECT row_number() over(ORDER BY title) rn, bseq, regdate, title, price, price_rent, useyn, likeyn
		       FROM ebook
		      WHERE title LIKE '%'||#{title}||'%') 
     WHERE rn <= #{criteria.pageNum} * #{criteria.rowsPerPage} 
       AND rn > (#{criteria.pageNum}-1) * #{criteria.rowsPerPage}
    ]]>
	</select>
	
	
</mapper>








